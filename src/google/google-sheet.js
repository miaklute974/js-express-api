const _ = require('lodash');
const fs = require('fs');
const { google } = require('googleapis');
require('dotenv').config();
require("./google-oauth-generate-url")


async function writeGoogleSheet(id) {


  //Oauth that reads from google-client-secret.json, which is generated by Google Cloud API Credentials page
  const redirectUris = ['http://localhost:3000', 'http://localhost:3000/success']
  const oAuth2Client = new google.auth.OAuth2(
    process.env.GOOGLE_CLIENT_ID, process.env.GOOGLE_CLIENT_SECRET, redirectUris[0],
  );

  //token is generated by google-oauth-get-tokens.js
  const token = fs.readFileSync(`${__dirname}\\google-oauth-token.json`, 'utf-8');
  oAuth2Client.setCredentials(JSON.parse(token));

  //Google sheets instance
  const sheets = google.sheets({ version: 'v4', auth: oAuth2Client });

  //Spreadsheet ID of our target
  const spreadsheetId = process.env.GOOGLE_SPREADSHEET_ID

  await sheets.spreadsheets.values.append({
    spreadsheetId,
    range: "Sheet1!A:Z",
    valueInputOption: "USER_ENTERED",
    resource: {
      values: [[1, 2, 3, 4, 5]], //this is actually an array of arrays
    }
  }).then((res) => {
    console.log(`Status: ${res.status}`);
    return true
  }).catch((err) => {
    console.error(err);
  });

};

module.exports = { writeGoogleSheet }